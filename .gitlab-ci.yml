image: silex/emacs:master-alpine-ci

stages: 
  - setup
  - publish

.setup: &setup
  script:
    - apk add --update --no-cache python3
  cache:
    paths:
      - /usr/bin/python3

.publish: &publish
  <<: *setup
  script:
  - make publish
  cache:
    paths:
      - .packages/
      - .timestamps/
    policy: pull-push
  artifacts:
    paths:
    - public

pages:
  stage: publish
  <<: *publish
  only:
  - master
